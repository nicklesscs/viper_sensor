<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />

  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/roslibjs/1.1.0/roslib.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/nipplejs/0.7.3/nipplejs.js"></script>

  <script type="text/javascript">
    var ros = new ROSLIB.Ros({
      url: 'ws://130.215.8.138:9090'
    });

    ros.on('connection', function () {
      document.getElementById("status").innerHTML = "Connected";
    });

    ros.on('error', function (error) {
      document.getElementById("status").innerHTML = "Error";
    });

    ros.on('close', function () {
      document.getElementById("status").innerHTML = "Closed";
    });

    var cmd_vel_listener = new ROSLIB.Topic({
      ros: ros,
      name: '/tf_polhemus',
      messageType: 'tf2_msgs/TFMessage'
    });

    // Create WebSocket connection to server
    const ws = new WebSocket('ws://130.215.8.138:8080');

    cmd_vel_listener.subscribe(function (vel) {
      var position = vel.transforms[0].transform.translation;
      var orientation = vel.transforms[0].transform.rotation;
      var messageData = {
        type: 'tf_polhemus',
        data: {
          position: { x: position.x, y: position.y, z: position.z },
          orientation: { x: orientation.x, y: orientation.y, z: orientation.z, w: orientation.w }
        }
      };

      // Send data to server
      ws.send(JSON.stringify(messageData), function (error) {
        if (error) {
          console.error('Failed to send data to server: ', error);
        } else {
          console.log('Data sent to server: ', messageData);
        }
      });

      var messageString = 'Position: (' + position.x + ',' + position.y + ',' + position.z + ')<br>' +
                          'Orientation: (' + orientation.x + ',' + orientation.y + ',' + orientation.z + ',' + orientation.w + ')';
      document.getElementById("/tf_polhemus").innerHTML = messageString;
    });

  </script>
</head>

<body>
  <h1>Simple ROS Interface</h1>
  <p>Connection status: <span id="status"></span></p>
  <p>Message from /tf_polhemus: <span id="/tf_polhemus"></span></p>
</body>

</html>
